attack_technique: T1070.002
display_name: 'Indicator Removal on Host: Clear Linux or Mac System Logs'
atomic_tests:
- name: rm -rf
  auto_generated_guid: 989cc1b1-3642-4260-a809-54f9dd559683
  description: |
    Delete system and audit logs
  supported_platforms:
  - macos
  - linux
  executor:
    command: |
      sudo rm -rf /private/var/log/system.log*
      sudo rm -rf /private/var/audit/*
    name: sh
    elevation_required: true
- name: Delete log files using built-in log utility 
  description: |
    Deletes main log datastore, inflight log data, time-to-live data(TTL), fault and error content
  supported_platforms:
  - macos
  executor:
    command: |
      sudo log erase --all
      sudo log erase --ttl #Deletes only time-to-live log content
      sudo log erase --predicate 'subsystem == "com.apple.appstore"' #Deletes all logs related to the App Store, useful for clearing specific entries of the system log
    name: sh
    elevation_required: true
- name: Truncate system log files 
  description: |
    Truncates the system log files, thus emptying the file content
  supported_platforms:
  - macos
  executor:
    command: |
      sudo truncate -s 0 /var/log/system.log
    name: sh
    elevation_required: true
- name: Delete log files by appending null bytes
  description: |
    Appends null bytes using /dev/null to the system log file
  supported_platforms:
  - macos
  executor:
    command: |
      sudo cat /dev/null > /var/log/system.log
    name: sh
    elevation_required: true
- name: System log file deletion using find utility
  description: |
    Finds and deletes the system log files within /var/log/ directory using various executions(rm, shred, unlink)
  supported_platforms:
  - macos
  executor:
    command: |
      sudo find /var/log -name 'system.log.*' -exec rm {} \; #using "rm" execution
      sudo find /var/log/ -name "system.log.*" -exec shred -u -z -n 3 {} \; #using "shred" execution
      sudo find /var/log/ -name "system.log.*" -exec unlink {} \; #using "unlink" execution
    name: sh
    elevation_required: true
- name: Overwrite macOS system log using echo utility
  description: |
   This test overwrites the contents of system log file with an empty string using echo utility
  supported_platforms:
  - macos
  executor:
    command: |
      sudo sh -c "echo '' > /var/log/system.log"
    name: sh
    elevation_required: true
- name: Real-time system log clearance/deletion
  description: |
   This test reads real-time system log file and writes empty string to it, thus clearing the log file without tampering with the logging process
  supported_platforms:
  - macos
  executor:
    command: |
     sudo log -f /var/log/system.log | : > /var/log/system.log
    name: sh
    elevation_required: true
- name: Delete system journal logs
  description: |
   This test reads real-time system log file and writes empty string to it, thus clearing the log file without tampering with the logging process
  supported_platforms:
  - linux
  executor:
    command: |
     sudo rm /var/log/journal/* #delete journal files using rm utility
     sudo journalctl --vacuum-time=0 #real-time deletion of journal files
    name: sh
    elevation_required: true
- name: Delete system log files using unlink utility
  description: |
   This test deletes the system log file
  supported_platforms:
  - macos
  - linux
  executor:
    command: |
     sudo unlink /var/log/system.log
    name: sh
    elevation_required: true
- name: Delete system log files using shred utility
  description: |
   This test overwrites the contents of the log file with zero bytes(-z) using three passes(-n 3) of data, and then delete the file(-u) securely
  supported_platforms:
  - macos
  - linux
  executor:
    command: |
     sudo shred -u -z -n 3 /var/log/system.log
    name: sh
    elevation_required: true
- name: Delete system log files using srm utility
  description: |
   This test securely deletes the system log files individually and recursively
   Refer: https://github.com/khell/homebrew-srm/issues/1 for installation
  supported_platforms:
  - macos
  executor:
    command: |
     sudo srm /var/log/system.log #system log file deletion
     sudo srm -r /var/log/ #recursive deletion of log files
    name: sh
    elevation_required: true
- name: Delete system log files using OSAScript
  description: |
   This test deletes the system log file using osascript via "do shell script", requires admin privileges
  supported_platforms:
  - macos
  executor:
    command: |
     osascript -e 'do shell script "rm /var/log/system.log" with administrator privileges'
    name: sh
    elevation_required: true
- name: Delete system log files using Applescript
  description: |
   This test deletes the system log file using applescript using osascript via Finder application
  supported_platforms:
  - macos
  executor:
    command: |
     osascript -e 'tell application "Finder" to delete POSIX file "/var/log/system.log"'
    name: sh
    elevation_required: true
- name: Overwrite Linux Mail Spool
  auto_generated_guid: 1602ff76-ed7f-4c94-b550-2f727b4782d4
  description: |
    This test overwrites the Linux mail spool of a specified user. This technique was used by threat actor Rocke during the exploitation of Linux web servers.
  supported_platforms:
  - linux
  input_arguments:
    username:
      description: Username of mail spool
      type: string
      default: root
  executor:
    command: |
      echo 0> /var/spool/mail/#{username}
    name: bash
- name: Overwrite Linux Log
  auto_generated_guid: d304b2dc-90b4-4465-a650-16ddd503f7b5
  description: |
    This test overwrites the specified log. This technique was used by threat actor Rocke during the exploitation of Linux web servers.
  supported_platforms:
  - linux
  input_arguments:
    log_path:
      description: Path of specified log
      type: path
      default: /var/log/secure
  executor:
    command: |
      echo 0> #{log_path}
    name: bash
